<!DOCTYPE html>
<html>
<head>
    <title>Chatbot</title>
    <style>
        /* Add your custom CSS styles here */
        /* ... */
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ’¬ Chatbot</h1>
        <div id="chatbox" class="chatbox"></div>
        <input type="text" id="userInput" placeholder="User Input">
        <button onclick="sendMessage()">Send</button>
    </div>

    <script>
        // JavaScript code goes here

        // API Key
        var api_key = "YOUR_API_KEY"; // Replace with your actual API key

        // Load data from data1.json
        fetch('./Metadata.json')
            .then(response => response.json())
            .then(data1 => {
                // Load data from data2.json
                fetch('./ICM Data.json')
                    .then(response => response.json())
                    .then(data2 => {
                        initializeChatbot(data1, data2);
                    })
                    .catch(error => console.error('Error loading data2.json:', error));
            })
            .catch(error => console.error('Error loading data1.json:', error));

        // Prompt list
        var prompt_list = [
            "You are a friendly AI assistant that helps answer questions based on data from JSON files.",
            "",
            "What you are able to do:",
            "- Answer general conversation questions such as 'How are you?'",
            "- Provide information based on the data in the JSON files",
            "- Answer questions related to the available keys in the JSON files",
            "",
            "What you are not able to do:",
            "- Provide information that is not present in the JSON files",
            "- Answer questions that are not related to the available keys in the JSON files",
            "- Provide rude or vulgar responses"
        ];

        // Function to initialize the chatbot
        function initializeChatbot(data1, data2) {
            // Function to get API response
            async function get_api_response(prompt) {
                try {
                    var response = await openai.Completion.create({
                        model: 'text-davinci-003',
                        prompt: prompt,
                        temperature: 0.7,
                        max_tokens: 256,
                        top_p: 1,
                        frequency_penalty: 0,
                        presence_penalty: 0.6,
                        stop: [' Human:', ' AI:']
                    });
                    return response;

                } catch (e) {
                    console.error('ERROR:', e);
                    return null;
                }
            }

            // Function to create the prompt
            function create_prompt(message, data1, data2) {
                var prompt = prompt_list.join('\n') + '\n\n';
                prompt += JSON.stringify(data1) + '\n\n';
                prompt += JSON.stringify(data2) + '\n\n';
                prompt += 'Human: ' + message;
                return prompt;
            }

            // Function to get the bot response
            async function get_bot_response(message, data1, data2) {
                var prompt = create_prompt(message, data1, data2);
                var response = await get_api_response(prompt);

                if (response) {
                    var choices = response.choices[0];
                    var reasoning = choices.reasoning;

                    if (reasoning) {
                        return [response.choices[0].text, reasoning];
                    } else {
                        return [response.choices[0].text, null];
                    }
                } else {
                    return ['Sorry, something went wrong...', null];
                }
            }

            // Helper function to create and append a message element
            function appendMessage(message, className) {
                var messageElement = document.createElement("div");
                messageElement.className = className;
                messageElement.innerHTML = message;

                var chatbox = document.getElementById("chatbox");
                chatbox.appendChild(messageElement);
            }

            // Function to send user input and receive bot response
            async function sendMessage() {
                var userInput = document.getElementById("userInput").value;
                appendMessage(userInput, "user-message");

                // Process user input and get bot response
                var [botResponse, reasoning] = await get_bot_response(userInput, data1, data2);

                // Display bot response
                appendMessage(botResponse, "bot-message");

                if (reasoning) {
                    // Button to show reasoning
                    var show_reasoning = prompt("Show Reasoning? (Y/N): ");

                    if (show_reasoning.toLowerCase() === "y") {
                        appendMessage("---", "data-info");
                        appendMessage("Reasoning:", "data-info");
                        appendMessage(reasoning, "data-info");
                    }
                }

                // Button to show data information
                var show_data_info = prompt("Show Data Information? (Y/N): ");

                if (show_data_info.toLowerCase() === "y") {
                    appendMessage("---", "data-info");
                    appendMessage("Data Information:", "data-info");
                    if (Array.isArray(data1) && Array.isArray(data2)) {
                        appendMessage("data1.json:", "data-info");
                        appendMessage(JSON.stringify(data1, null, 4), "data-info");
                        appendMessage("data2.json:", "data-info");
                        appendMessage(JSON.stringify(data2, null, 4), "data-info");
                    } else {
                        appendMessage("Invalid data format for data1.json or data2.json", "data-info");
                    }
                }

                document.getElementById("userInput").value = "";
            }
        }
    </script>
</body>
</html>
